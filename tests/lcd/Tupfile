# Tupfile

include_rules

# Compile source to object code.
: foreach src/*.c |> $(CC) $(CFLAGS) -c -o %o %f |> tmp/%B.o

# Compile object code to elf.
: tmp/*.o | $(NBAVR_TOP)/libnbavr.a |> $(CC) $(CFLAGS) -o %o %f -L$(NBAVR_TOP) -lnbavr |> gen/firmware.elf

# Decompile elf to asm, for debugging.
: gen/firmware.elf |> $(OBJDUMP) -S --architecture=avr --disassemble %f > %o |> gen/firmware.asm

# Generate gitignore file.
.gitignore
