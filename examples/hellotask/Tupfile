include_rules

# "-ffunction-sections" and "-Wl,-gc-sections" make the compiler and linker only include functions which are needed.

# Compile source to object code.
: foreach src/*.c |> avr-gcc $(CFLAGS) -c -o %o %f |> tmp/%B.o

# Compile object code to elf.
: tmp/*.o | $(LIBFILES) |> avr-gcc $(CFLAGS) -o %o %f $(LDFLAGS) |> gen/firmware.elf

# Convert elf to hex.
: gen/firmware.elf |> avr-objcopy -O ihex %f %o |> gen/firmware.hex

# Decompile elf to asm, for debugging.
: gen/firmware.elf |> avr-objdump -S --architecture=avr --disassemble %f > %o |> gen/firmware.asm
